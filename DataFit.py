#This script used the data extracted from main.py to determine the Temperature

import numpy as np
import matplotlib.pyplot as plt
import scipy.odr as odr

xass = np.array([0.0, 4e-06, 8e-06, 1.2e-05, 1.6e-05, 2.4e-05, 3.2e-05, 4.4e-05, 5.9999999999999995e-05, 7.999999999999999e-05, 0.000104, 0.00013199999999999998, 0.00017199999999999998, 0.00023999999999999998, 0.000308])*1
#yass = np.array([643.9375, 500.1875, 400.5625, 322.125, 314.5, 232.25, 159.3125, 88.1875, 49.75, 23.75, 13.75, 8.0625, 4.6875, 4.625, 5.125])
#yerror = [17.009073865146213, 33.03448718763468, 15.410908271416062, 11.483003744665417, 11.051018052650171, 14.834503699146797, 18.404207229598345, 9.187074820093716, 9.845684333757609, 3.6996621467371855, 5.673402858955108, 2.461421083439402, 0.582961190818051, 0.5994789404140899, 0.9270248108869579]
xerror = np.array([4e-07, 4e-07, 4e-07, 4e-07, 4e-07, 4e-07, 4e-07, 4e-07, 4e-07, 4e-07, 4e-07, 4e-07, 4e-07, 4e-07, 4e-07])*1

#yass = [518.5, 209.5, 141.9375, 97.25, 101.8125, 67.3125, 41.0625, 24.125, 12.875, 5.1875, 1.375, 0.75, 0.125, 0.125, 0.125]
#yerror = [45.80665890457413, 18.172781845386247, 12.527313908017152, 8.51836251870041, 9.200670831520927, 8.364499013688746, 5.6730585886274785, 4.910129835350589, 5.0974871260259205, 1.911110606427582, 1.2183492931011204, 0.75, 0.33071891388307384, 0.01, 0.33071891388307384]

yass = [630.8125, 365.3125, 264.5625, 201.9375, 200.375, 139.5, 90.1875, 51.3125, 26.75, 11.6875, 4.1875, 2.0625, 1.0625, 0.75, 0.9375]
yerror = [16.662903220927618, 30.480975111534736, 14.928867798664438, 9.509657919715094, 8.652131240336105, 13.228756555322953, 10.841002894105323, 6.907593195172976, 8.011710179481033, 2.6860461183680373, 2.833256739160784, 1.6381678027601445, 0.5555121510822243, 0.4330127018922193, 0.899218410621135]

#yass = [643.3125, 463.0, 328.6875, 255.4375, 254.3125, 179.75, 120.4375, 68.3125, 38.1875, 17.6875, 9.1875, 5.4375, 3.1875, 3.0, 3.5]
#yerror = [16.840126001606993, 33.415939310454824, 19.41558249834395, 9.027518692863504, 8.886216503664537, 14.471955638406303, 15.803357040515158, 8.694241988235662, 8.632922086408518, 3.512811374099099, 4.2311161352532025, 2.1203994317109216, 0.3903123748998999, 0.1, 1.0]

Kb = 1.38e-23
d = 7.5e-7
g = 9.81
c = (np.pi*d*d*d*(1.05-0.997)*g*10*10*10)/(6*Kb)
def f(B, x):
    return yass[0]*np.exp(-c*x/B[0])

B_start = [294, 650]

odr_model = odr.Model(f)

odr_data  = odr.RealData(xass,yass,sx=xerror,sy=yerror)

odr_obj   = odr.ODR(odr_data,odr_model,beta0=B_start)

odr_res   = odr_obj.run()

par_best = odr_res.beta
par_sig_ext = odr_res.sd_beta
par_cov = odr_res.cov_beta 
print(" De (INTERNE!) covariantiematrix  = \n", par_cov)
chi2 = odr_res.sum_square
print("\n Chi-squared         = ", chi2)
chi2red = odr_res.res_var
print(" Reduced chi-squared = ", chi2red, "\n")
odr_res.pprint()

xplot = np.linspace(np.min(xass),np.max(xass),num=100)

plt.plot(xplot,f(par_best,xplot),'r-',label="model")
plt.errorbar(xass, yass, yerr=yerror, fmt="ko", label="data")
plt.xlabel("Ticks")
plt.ylabel("Particle count")
plt.xlim(0, max(xass))
plt.ylim(0,max(yass))
plt.legend()
plt.show()
